# 曲线工具 - 控制点调整功能说明

## 功能概述

曲线工具现在支持两阶段交互，用户可以在绘制完曲线后调整控制点位置，以精确控制曲线弯曲程度。

## 使用方法

### 阶段1 - 绘制曲线

1. 在工具栏选择"曲线"工具
2. 在画布上按下鼠标左键确定曲线起点
3. 拖动鼠标到终点位置，会实时预览曲线（控制点默认在中点上方）
4. 释放鼠标，自动进入阶段2

### 阶段2 - 调整控制点

1. 释放鼠标后会看到一个蓝色圆圈，这就是控制点
2. 拖动控制点可以调整曲线弯曲程度
3. 有三种方式确认曲线：
   - 按 **Enter** 键
   - 双击画布
   - 切换到其他工具
4. 按 **Esc** 键可以取消当前曲线

## 技术实现

### 状态管理

```typescript
// 曲线绘制阶段
const curvePhase = ref<'draw' | 'adjust' | 'done'>('draw');

// 曲线关键点
const curvePoints = ref<{
  start: { x: number; y: number };      // 起点
  end: { x: number; y: number };        // 终点
  control: { x: number; y: number };    // 控制点
} | null>(null);

// 是否正在拖动控制点
const draggingControlPoint = ref<boolean>(false);
```

### 交互逻辑

1. **阶段转换**
   - mousedown → 开始绘制（阶段1）
   - mouseup → 进入调整阶段（阶段2）
   - Enter/双击 → 确认曲线（阶段3：done）
   - Esc → 取消曲线，回到阶段1

2. **控制点可视化**
   - 白色填充，蓝色边框的圆圈
   - 半径 6px
   - 位于控制点坐标位置

3. **切换工具处理**
   - 如果在调整阶段切换工具，自动确认当前曲线
   - 确保不会丢失用户的绘制内容

### 键盘快捷键

- **Enter**: 确认曲线
- **Esc**: 取消曲线
- 普通工具快捷键（Ctrl+Z/Y/S）不受影响

## 更新日志

**2026-02-16**
- 实现两阶段交互机制
- 添加控制点可视化
- 支持拖动调整控制点
- 支持 Enter/Esc 快捷键
- 支持双击确认
- 切换工具时自动确认

## 后续优化建议

1. 可考虑添加控制点悬停高亮效果
2. 可考虑添加多条曲线同时编辑支持
3. 可考虑添加控制点吸附功能（对齐到网格或其他点）
